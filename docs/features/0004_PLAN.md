Technical Plan: Notifications and Billing
This document outlines the technical implementation for the new Notifications and Billing pages.

Notifications Page
1. Data Layer
New Models:
Notification Model (backend/models/Notification.js):

userId: Sequelize.INTEGER, foreign key to User

type: Sequelize.ENUM('new_post', 'new_comment', 'new_follower', 'suggestion_creator', 'suggestion_content', 'message', 'billing_success', 'billing_failure', 'billing_expiring')

content: Sequelize.TEXT

isRead: Sequelize.BOOLEAN, default false

relatedId: Sequelize.INTEGER (e.g., postId, commentId, followerId)

NotificationSetting Model (backend/models/NotificationSetting.js):

userId: Sequelize.INTEGER, foreign key to User

emailNotifications: Sequelize.JSON

newPost: BOOLEAN, default true

newComment: BOOLEAN, default true

suggestedCreators: BOOLEAN, default true

suggestedContent: BOOLEAN, default true

messages: BOOLEAN, default true

billing: BOOLEAN, default true

websiteNotifications: Sequelize.JSON (same structure as emailNotifications)

2. Backend
New Services:
NotificationService (backend/services/NotificationService.js):

createNotification(userId, type, content, relatedId): Creates a new notification in the database.

getNotifications(userId, filters): Retrieves a list of notifications for a user, with optional filters (e.g., isRead, type).

markAsRead(notificationId): Marks a single notification as read.

markAllAsRead(userId): Marks all notifications for a user as read.

getNotificationSettings(userId): Retrieves the user's notification settings.

updateNotificationSettings(userId, settings): Updates the user's notification settings.

New Routes:
notifications.js (backend/routes/notifications.js):

GET /: Get all notifications for the authenticated user.

GET /settings: Get notification settings for the authenticated user.

PUT /settings: Update notification settings.

POST /:id/read: Mark a notification as read.

POST /read-all: Mark all notifications as read.

Existing Service Modifications:
EmailService (backend/services/EmailService.js):

Integrate with NotificationService to send emails based on user's NotificationSetting.

CreatorService.js, MediaService.js, SubscriptionService.js:

Trigger NotificationService.createNotification for relevant events (e.g., new post, new comment, subscription status change).

3. Frontend
New Pages:
NotificationsPage (src/pages/Notifications.tsx):

Default view lists recent notifications.

Implement filtering UI (by type, read/unread).

"Mark as Read" and "Mark All as Read" buttons.

Component to manage notification settings, allowing users to toggle email and website notifications for:

When someone you follow posts

When someone you follow comments

Suggested creators

Suggested content

Messages

Billing (success/failure/expiring)

New Components:
NotificationList (src/components/notifications/NotificationList.tsx): Displays a list of notifications.

NotificationItem (src/components/notifications/NotificationItem.tsx): Renders a single notification with relevant information.

NotificationSettings (src/components/notifications/NotificationSettings.tsx): Form to manage notification preferences.

Billing Page
1. Data Layer
No new models are required. Existing Subscription, Payment, and User models will be used.

2. Backend
New Routes:
billing.js (backend/routes/billing.js):

GET /subscriptions: Get current and past subscriptions for the authenticated user.

POST /subscriptions/:id/cancel: Cancel an active subscription.

GET /history: Get billing history (payments).

POST /refund-request: Creates a support ticket or sends an email to support for a refund request.

GET /payment-methods: Get saved payment methods.

POST /payment-methods: Add a new payment method.

DELETE /payment-methods/:id: Delete a saved payment method.

Existing Service Modifications:
PaymentService (backend/services/PaymentService.js):

requestRefund(paymentId, userId): Logic to handle refund requests. This could involve creating a support ticket or sending an email to the support team.

SubscriptionService (backend/services/SubscriptionService.js):

cancelSubscription(subscriptionId, userId): Logic to cancel a subscription.

3. Frontend
New Pages:
BillingPage (src/pages/Billing.tsx):

Tabbed layout:

Current Subscriptions:

Display active subscriptions with start date, renewal/end date.

"Cancel Subscription" button.

Billing History:

List of past payments.

"Request Refund" button next to each payment, which initiates the refund process.

Saved Payment Methods:

Display saved payment methods.

"Add New Method" and "Delete" buttons.

New Components:
SubscriptionTab (src/components/billing/SubscriptionTab.tsx): Manages and displays user subscriptions.

BillingHistoryTab (src/components/billing/BillingHistoryTab.tsx): Displays payment history and handles refund requests.

PaymentMethodsTab (src/components/billing/PaymentMethodsTab.tsx): Manages user's payment methods.