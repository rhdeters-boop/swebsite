# Security & Privacy Page - Technical Plan

## Brief Description
Create a comprehensive security and privacy management page at `/security` with three main sections: Account Security, Privacy Controls, and Danger Zone. The page will follow the established design system and reuse existing security infrastructure while adding new privacy features for profile visibility, audience control, and user blocking.

## Required Files and Changes

### Database Changes

#### New Models
- **`backend/models/UserBlock.js`** - Track blocked users
  - `id` (UUID, primary key)
  - `blockerId` (UUID, references users.id)
  - `blockedUserId` (UUID, references users.id)
  - `reason` (ENUM: 'harassment', 'spam', 'inappropriate', 'other')
  - `createdAt`, `updatedAt`
  - Unique index on `[blockerId, blockedUserId]`

- **`backend/models/UserPrivacySettings.js`** - Privacy preferences
  - `id` (UUID, primary key)
  - `userId` (UUID, references users.id, unique)
  - `profileVisibility` (ENUM: 'public', 'private') - default 'public'
  - `postVisibility` (ENUM: 'public', 'followers_only', 'subscribers_only') - default 'public'
  - `allowFollowRequests` (BOOLEAN) - default true
  - `showOnlineStatus` (BOOLEAN) - default true
  - `allowDirectMessages` (ENUM: 'everyone', 'followers_only', 'none') - default 'everyone'
  - `createdAt`, `updatedAt`

#### Model Updates
- **`backend/models/User.js`** - Add new fields:
  - `accountPaused` (BOOLEAN, default false)
  - `pausedAt` (DATE, nullable)
  - `pauseReason` (TEXT, nullable)

- **`backend/models/Follow.js`** - Add pending follow functionality:
  - `status` (ENUM: 'pending', 'approved', 'rejected') - default 'approved'
  - `requestedAt` (DATE)
  - `respondedAt` (DATE, nullable)

#### Database Associations
- **`backend/models/index.js`** - Add new associations:
  - User.hasOne(UserPrivacySettings)
  - User.hasMany(UserBlock, as: 'blockedUsers', foreignKey: 'blockerId')
  - User.hasMany(UserBlock, as: 'blockedBy', foreignKey: 'blockedUserId')

### Backend Services

#### New Services
- **`backend/services/PrivacyService.js`** - Privacy management
  - `getPrivacySettings(userId)` - Get user privacy settings
  - `updatePrivacySettings(userId, settings)` - Update privacy preferences
  - `blockUser(blockerId, blockedUserId, reason)` - Block a user
  - `unblockUser(blockerId, blockedUserId)` - Unblock a user
  - `getBlockedUsers(userId, pagination)` - List blocked users
  - `isUserBlocked(userId, targetUserId)` - Check if user is blocked
  - `pauseAccount(userId, reason)` - Pause account functionality
  - `unpauseAccount(userId)` - Unpause account
  - `deleteAccountData(userId)` - Soft delete account and content

#### Service Updates
- **`backend/services/AuthService.js`** - Extend existing security functions:
  - Update `updateSecuritySettings()` to handle additional security preferences
  - Add `requestAccountDeletion(userId, password)` method
  - Add `confirmAccountDeletion(userId, token)` method

- **`backend/services/UserService.js`** - Privacy-aware user queries:
  - Update user lookup methods to respect privacy settings
  - Filter blocked users from search results and recommendations
  - Handle private profile visibility

### Backend Routes

#### New Routes
- **`backend/routes/privacy.js`** - Privacy management endpoints
  - `GET /privacy/settings` - Get current privacy settings
  - `PUT /privacy/settings` - Update privacy settings
  - `GET /privacy/blocked-users` - List blocked users with pagination
  - `POST /privacy/block/:userId` - Block a user
  - `DELETE /privacy/block/:userId` - Unblock a user
  - `POST /privacy/pause-account` - Pause account
  - `POST /privacy/unpause-account` - Unpause account

#### Route Updates
- **`backend/routes/auth.js`** - Extend security endpoints:
  - `POST /auth/request-account-deletion` - Request account deletion
  - `POST /auth/confirm-account-deletion` - Confirm deletion with token
  - Update existing security settings endpoint to include new fields

- **`backend/routes/users.js`** - Privacy-aware endpoints:
  - Update user profile endpoints to check privacy settings
  - Filter follow requests based on privacy settings
  - Handle pending follow requests for private accounts

### Frontend Components

#### New Pages
- **`src/pages/Security.tsx`** - Main security & privacy page
  - Implements three-tab interface (Account Security, Privacy, Danger Zone)
  - Uses existing `useSecuritySettings` hook and new `usePrivacySettings` hook
  - Follows ui_request.md design specifications with dark theme, transparent cards

#### New Hooks
- **`src/hooks/usePrivacySettings.ts`** - Privacy state management
  - `privacySettings` - Current privacy configuration
  - `blockedUsers` - List of blocked users with pagination
  - `isLoading`, `error`, `success` - Standard states
  - `updatePrivacySettings(settings)` - Update privacy preferences
  - `blockUser(userId, reason)` - Block user functionality
  - `unblockUser(userId)` - Unblock user functionality
  - `pauseAccount(reason)` - Pause account
  - `unpauseAccount()` - Unpause account

- **`src/hooks/useAccountDeletion.ts`** - Account deletion flow
  - `requestDeletion(password)` - Initial deletion request
  - `confirmDeletion(token)` - Confirm deletion with email token
  - `cancelDeletion()` - Cancel pending deletion

#### Component Updates
- **`src/App.tsx`** - Add new route:
  - `<Route path="/security" element={<Security />} />`

- **`src/components/Navbar.tsx`** - Add security link to user dropdown menu

#### New UI Components
- **`src/components/security/PrivacySettingsSection.tsx`** - Privacy controls
- **`src/components/security/BlockedUsersManager.tsx`** - Blocked users list
- **`src/components/security/AccountPauseControls.tsx`** - Pause/unpause account
- **`src/components/security/DangerZoneSection.tsx`** - Account deletion flow

## Privacy Features Algorithm

### Profile Privacy Logic
1. **Public Profiles**: Visible to everyone, accepts follows automatically
2. **Private Profiles**: Only visible to approved followers
   - Follow requests go to pending status
   - User must approve/reject requests manually
   - Unapproved users see limited profile info

### Content Visibility Algorithm
1. **Public Posts**: Visible to all users
2. **Followers Only**: Visible to approved followers
3. **Subscribers Only**: Visible to active subscribers (creators only)

### User Blocking Logic
1. **Blocked User Restrictions**:
   - Cannot view blocker's profile or content
   - Cannot send follow requests or messages
   - Cannot see blocker in search results
   - Existing follows are automatically removed
2. **Mutual Blocking**: Works bidirectionally

### Account Pause Logic
1. **Paused Account Behavior**:
   - Profile becomes invisible to all users
   - Content is hidden but not deleted
   - Cannot receive new follows or messages
   - User can unpause anytime
   - Existing subscriptions remain active but content is inaccessible

## Design System Implementation

Following `ui_request.md` specifications:

### Color Usage
- **Background**: `bg-void-gradient` for main content area
- **Cards**: Transparent with `border-border-muted` and `shadow-card`
- **Primary Actions**: `bg-seductive` with `shadow-glow-seductive` on hover
- **Danger Actions**: `bg-red-600` with hover states
- **Success States**: Green variants for confirmations

### Typography
- **Page Title**: `text-4xl font-bold text-gradient` using `font-serif`
- **Section Titles**: `text-3xl font-semibold text-primary`
- **Card Titles**: `text-2xl font-semibold text-primary`
- **Body Text**: `text-base font-normal text-secondary`

### Component Style
- **Surfaces**: `rounded-xl border border-border-muted shadow-card`
- **Interactive Elements**: Hover effects with `border-secondary` and `shadow-card-hover`
- **Form Inputs**: `focus:border-primary focus:ring-2 focus:ring-border-primary`

## Additional Feature Ideas

### Enhanced Security Features
1. **Two-Factor Authentication (2FA)**
   - SMS or authenticator app support
   - Backup codes for recovery
   - Required for sensitive operations

2. **Login Activity Monitor**
   - Device tracking and recognition
   - Location-based login alerts
   - Suspicious activity notifications

3. **Advanced Privacy Controls**
   - Content download restrictions
   - Screenshot prevention (where possible)
   - Watermarking for subscription content

4. **Granular Blocking Options**
   - Temporary blocks with expiration
   - Block reasons and notes
   - Mass blocking for spam accounts

### Compliance & Safety Features
1. **Data Export Tool**
   - GDPR compliance for data portability
   - Export user data and content
   - Deletion confirmation with data summary

2. **Privacy Dashboard**
   - Data usage analytics
   - Third-party integrations overview
   - Consent management

3. **Safety Center**
   - Reporting tools integration
   - Safety tips and best practices
   - Community guidelines access

These additional features could be implemented in future iterations to enhance user safety and platform compliance while maintaining the core security and privacy functionality outlined in this plan.
