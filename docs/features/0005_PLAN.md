Technical Plan: Explore & My Feed Pages
This document outlines the technical implementation for the new Explore page, personalized My Feed page, and the underlying systems for content recommendation and discovery.

Phase 1: Data Layer
New Models:
Tag Model (backend/models/Tag.js):

name: Sequelize.STRING, unique.

type: Sequelize.ENUM('genre', 'ethnicity', 'body_type', 'fetish') to categorize tags.

CreatorTag Model (backend/models/CreatorTag.js):

creatorId: Foreign key to Creator.

tagId: Foreign key to Tag.

MediaItemTag Model (backend/models/MediaItemTag.js):

mediaItemId: Foreign key to MediaItem.

tagId: Foreign key to Tag.

UserInteraction Model (backend/models/UserInteraction.js):

userId: Foreign key to User.

interactionType: Sequelize.ENUM('view', 'like', 'share', 'subscribe', 'follow', 'search').

targetId: Sequelize.INTEGER (can be creatorId, mediaItemId, tagId).

targetType: Sequelize.ENUM('creator', 'media', 'tag').

metadata: Sequelize.JSON for extra data (e.g., watch duration).

UserMediaState Model (backend/models/UserMediaState.js):

userId: Foreign key to User.

mediaItemId: Foreign key to MediaItem.

isFavorite: Sequelize.BOOLEAN, default false.

watchLater: Sequelize.BOOLEAN, default false.

Model Modifications:
Creator Model (backend/models/Creator.js):

Add new attribute: age: Sequelize.INTEGER.

User Model (backend/models/User.js):

Add new attribute: allowTracking: Sequelize.BOOLEAN, default false.

MediaAnalytics Model (backend/models/MediaAnalytics.js):

Add new attribute: rating: Sequelize.FLOAT to store a calculated rating.

Phase 2A: Backend Implementation (API)
New Services:
RecommendationService (backend/services/RecommendationService.js):

getPersonalizedFeed(userId): Generates a personalized feed based on UserInteraction data.

getSuggestedCreators(userId): Recommends creators based on user's liked tags and viewed creator profiles.

getWatchAgainContent(userId): Retrieves content the user has viewed multiple times.

recordInteraction(userId, type, targetId, targetType, metadata): Logs a user interaction event.

TagService (backend/services/TagService.js):

assignTagsToCreator(creatorId, tagIds).

assignTagsToMedia(mediaItemId, tagIds).

getCreatorsByTag(tagId, filters, sorting).

getMediaByTag(tagId, filters, sorting).

Service Modifications:
AnalyticsService (backend/services/AnalyticsService.js):

calculateTrendingScores(): Implement a ranking algorithm to determine trending content and creators.

Algorithm: The score will be a weighted sum of recent interactions (views, likes, shares) with a time-decay factor. For example: score = (views_last_24h * W1 + likes_last_24h * W2) / (hours_since_post ^ G). The weights (W1, W2) and gravity (G) will be configurable. This function will run periodically as a background job to update scores.

getTrendingCreators(limit).

getMostViewedMedia(limit, timePeriod).

getHighestRatedMedia(limit).

MediaService (backend/services/MediaService.js):

Modify upload functions to accept and process tags via TagService.

optimizeMedia(mediaItemId): Integrate media optimization logic.

Algorithm: On upload, videos will be transcoded into multiple bitrates for adaptive streaming. Images will be compressed and resized into various formats (e.g., thumbnail, standard view). This will be handled by interacting with a media processing library (like FFmpeg) and the StorageService.

UserService (backend/services/UserService.js):

updateTrackingConsent(userId, allowTracking): Function to update the user's consent for personalization.

New Routes:
explore.js (backend/routes/explore.js):

GET /: Get default Explore page content (carousels for Trending, Most Viewed, Highest Rated, Newest).

GET /personalized: Get personalized Explore page content for the authenticated user.

GET /random-creator: Get a curated "random" creator.

feed.js (backend/routes/feed.js):

GET /: Get the personalized "My Feed" content for the authenticated user.

GET /gallery: Get all media from subscribed creators with filtering options.

tags.js (backend/routes/tags.js):

GET /: List all available tags/categories.

GET /:id/content: Get content for a specific tag, with support for filtering and sorting parameters (age, ethnicity, body_type, fetish_type, trending, most_views, highest_rated, newest).

Phase 2B: Frontend Implementation (UI)
New Pages:
CategoryPage (src/pages/CategoryPage.tsx):

Displays a grid of creators or media items for a specific category.

Will include a filter sidebar component.

Will include sorting dropdowns.

SubscribedGallery (src/pages/SubscribedGallery.tsx):

Displays a gallery of all media from creators the user is subscribed to.

Includes filters for creator(s) and media type(s).

Includes buttons for "Add to Favorites," "Add to Watch Later," and "Randomize."

Page Modifications:
Explore.tsx (src/pages/Explore.tsx):

Rewrite to display multiple MediaCarousel and CreatorCarousel components.

The default view will fetch data for "Trending," "Most Viewed," "Highest Rated," and "Newest."

If the user is logged in and has consented to tracking, it will fetch personalized carousels.

Add navigation elements: a button to "My Feed," a link to a list of all categories, and a "Random Creator" button.

MyFeed.tsx (src/pages/MyFeed.tsx):

Implement conditional rendering:

If not logged in, show a component prompting login/registration.

If logged in but allowTracking is false, display a subtle banner asking for permission to personalize the feed.

Display carousels for: "New Subscribed Content," "Public Posts from Follows," "Watch Again," "New PPVs," and "Suggested Content."

Add a prominent "View All Content" button that navigates to the SubscribedGallery page.

New Components:
MediaCarousel (src/components/carousels/MediaCarousel.tsx):

Displays a horizontally scrolling list of MediaItemCard components.

Will have a category label with an arrow that links to the corresponding CategoryPage.

Features translucent buttons on each side for navigation.

FilterSidebar (src/components/filters/FilterSidebar.tsx):

A component with checkboxes and sliders for filtering content by tags (age, ethnicity, body type, fetish type).

TrackingConsentBanner (src/components/ui/TrackingConsentBanner.tsx):

A banner to be displayed on the MyFeed page to ask for user consent for personalization.

Refinements v0.1 (Implemented)
- Server-aware pagination for creator media:
  - Added additive pagination to creators show endpoints with validated page/limit and deterministic ordering.
  - Endpoints return mediaPagination: { page, limit, total, pages }.
  - Code: [router.get()](backend/routes/creators.js:138) uses validated query params; [CreatorService.getCreatorById()](backend/services/CreatorService.js:191) and [CreatorService.getCreatorByUsername()](backend/services/CreatorService.js:245) perform findAndCountAll with stable ordering.
- Frontend pagination components:
  - Reusable, accessible breadcrumbs: [BreadcrumbNav()](src/components/BreadcrumbNav.tsx:1).
  - Prefetch wrapper: [MediaPaginator()](src/components/MediaPaginator.tsx:1).
  - Integrated into creator content page with URL sync (?page=1), clamping, and smooth scroll: [CreatorProfile.tsx](src/pages/CreatorProfile.tsx).
- Defaults:
  - Default page size: 24 (creator media).
  - Max limit enforced at router level: 50.
  - Sliding window: current ±2, first/last with ellipses.
  - Keyboard: Left/Right prev/next, Home/End first/last, no wrap.
- Progressive enhancement:
  - Anchors work without JS; SPA enhancement via onNavigate handler.
- Performance:
  - Adjacent page prefetch in [useCreatorProfile()](src/hooks/useCreatorProfile.ts:1) with TanStack Query.
- Styling and A11y:
  - Uses existing .focus-ring and semantic colors; aria-current=page on active item; nav/ol/li semantics.
- Follow-ups (non-breaking, optional):
  - Extend paginator to other media-heavy pages when they land (e.g., SubscribedGallery).
  - Consider cursor pagination for very large datasets later; current offset/limit is sufficient.

Open questions and assumptions
- Default page size and bounds:
  - Assumed default 24, max 50. Confirm if different values are desired globally.
- Pagination method:
  - Kept offset/limit for now to minimize changes. Confirm if/when to migrate to cursor pagination for specific endpoints.
- Ellipsis/window:
  - Implemented current ±2; confirm if window size should be configurable at page-level.
- Media metadata:
  - Breadcrumbs only require totals; no extra media metadata added.
- Tests:
  - Jest is present but ESM config is not set up. Propose adding Jest ESM config before adding integration tests for creators pagination endpoints.